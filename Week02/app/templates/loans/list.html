{% extends "base.html" %}

{% block content %}
<div class='d-flex justify-content-between align-items-center mb-3'>
  <h3>Mượn/Trả</h3>
  <a class='btn btn-primary' href='{{ url_for("loans.borrow") }}'>+ Tạo phiếu mượn</a>
</div>
<table class='table table-striped table-bordered'>
  <thead><tr><th>ID</th><th>Sách</th><th>Thành viên</th><th>Ngày mượn</th><th>Hạn trả</th><th>Trạng thái</th><th></th></tr></thead>
  <tbody>
    {% for loan in loans %}
    <tr>
      <td>{{ loan.id }}</td>
      <td>{{ loan.book.title }}</td>
      <td>{{ loan.member.name }}</td>
      <td>{{ loan.borrowed_at.strftime('%Y-%m-%d') }}</td>
      <td>{{ loan.due_date.strftime('%Y-%m-%d') }}</td>
      <td>
        {% if loan.is_active() %}
          Đang mượn
          {% if loan.due_date < datetime.now() %}
            <span class='badge bg-danger ms-2'>Quá hạn</span>
          {% endif %}
        {% else %}
          Đã trả ({{ loan.returned_at.strftime('%Y-%m-%d') }})
        {% endif %}
      </td>
      <td>
        {% if loan.is_active() %}
          <form action='{{ url_for("loans.return_loan", loan_id=loan.id) }}' method='post' style='display:inline;'>
            <button type='submit' class='btn btn-sm btn-success' onclick="return confirm('Xác nhận trả sách?');">Trả</button>
          </form>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}